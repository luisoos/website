---
interface Props {
	repo: string; // Format: "owner/repo"
}

const { repo } = Astro.props;

if (!repo || !repo.includes('/')) {
	throw new Error('GitHubEmbed: repo prop must be in format "owner/repo"');
}

// Fetch repository data from GitHub API
const response = await fetch(`https://api.github.com/repos/${repo}`, {
	headers: {
		'Accept': 'application/vnd.github+json',
		'X-GitHub-Api-Version': '2022-11-28',
	},
});

if (!response.ok) {
	throw new Error(`Failed to fetch GitHub repository: ${repo}`);
}

const data = await response.json();

const {
	name,
	description,
	html_url,
	language,
	stargazers_count,
	private: isPrivate,
	owner,
} = data;

// Format star count
const formatStars = (count: number) => {
	if (count >= 1000) return (count / 1000).toFixed(1) + 'k';
	return count.toString();
};

// Language color mapping
const languageColors: Record<string, string> = {
	TypeScript: '#3178c6',
	JavaScript: '#f1e05a',
	Python: '#3572A5',
	Rust: '#ce422b',
	Go: '#00ADD8',
	Java: '#b07219',
	'C++': '#f34b7d',
	CSS: '#563d7c',
	HTML: '#e34c26',
	Vue: '#2c3e50',
	React: '#61dafb',
};

const langColor = languageColors[language] || '#858585';
---

<a
	href={html_url}
	target="_blank"
	rel="noopener noreferrer"
	class="no-underline group block rounded-lg border border-neutral-200 p-4 shadow-inner transition-all duration-200 hover:border-neutral-300 dark:hover:border-neutral-700"
>
	<div class="flex items-start justify-between mb-3">
		<div class="flex items-center gap-2">
			<svg class="w-4 h-4" fill="currentColor" viewBox="0 0 16 16">
				<path d="M2 2a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v13.5a.5.5 0 0 1-.777.416L8 13.71l-5.223 2.206A.5.5 0 0 1 2 15.5V2zm2-1a1 1 0 0 0-1 1v12.566l4.723-2.482a.5.5 0 0 1 .554 0L13 14.566V2a1 1 0 0 0-1-1H4z"/>
			</svg>
			<span class="font-semibold group-hover:text-blue-600 transition-colors">
				{name}
			</span>
		</div>
		<div class="flex items-center gap-2">
			<span class="text-xs font-medium px-2 py-1 rounded-full">
				{isPrivate ? 'Private' : 'Public'}
			</span>
		</div>
	</div>

	{description && (
		<p class="text-sm mb-3 line-clamp-2">
			{description}
		</p>
	)}

	<div class="flex items-center justify-between">
		<div class="flex items-center gap-4 text-xs">
			{language && (
				<div class="flex items-center gap-1.5">
					<span class="w-3 h-3 rounded-full border-[0.1px] border-neutral-600" style={`background-color: ${langColor}`}></span>
					<span>{language}</span>
				</div>
			)}
			{stargazers_count > 0 && (
				<div class="flex items-center gap-1">
					<svg class="w-4 h-4" fill="currentColor" viewBox="0 0 16 16">
						<path d="M8 .25a.75.75 0 0 1 .673.418l1.882 3.815 4.147.612a.75.75 0 0 1 .416 1.279l-3.046 2.97.719 4.192a.75.75 0 0 1-1.088.791L8 12.347l-3.766 1.98a.75.75 0 0 1-1.088-.79l.72-4.194L.818 6.374a.75.75 0 0 1 .416-1.28l4.147-.611L7.327.668A.75.75 0 0 1 8 .25Z"/>
					</svg>
					<span>{formatStars(stargazers_count)}</span>
				</div>
			)}
		</div>
		<svg class="w-4 h-4 group-hover:translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
			<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
		</svg>
	</div>
</a>
